import{g as O,c as X,u as H,f as J,v as K}from"./main.c4ed6aa9.js";import{g as Q,i as I,j as W,k as B,m as v,n as h,a2 as x,q as Y,r as d,o as _,s as j,w as l,t as p,v as f,x as $,y as e,b as a,c as N,z as Z,A as U}from"./vendor.e9042f2c.js";const ee={class:"flex justify-between w-full"},oe={key:0,action:""},te={class:"px-8 py-8 sm:p-6"},ae={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},re={key:1},se={class:"my-6 mx-4 border border-gray-200 relative"},ne=f(" Edit "),le=["src"],ie={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},me={setup(ue){const c=O(),M=X(),P=H(),k=J();K();const{t:u}=Q();let i=I(!1);const C=I(""),b=I(!1),z=I(["customer","customerCustom","invoice","invoiceCustom","company"]),r=W({id:null,from:null,to:null,subject:"New Invoice",body:null}),D=B(()=>c.active&&c.componentName==="SendInvoiceModal"),G=B(()=>c.title),q=B(()=>c.data),A={from:{required:v.withMessage(u("validation.required"),h),email:v.withMessage(u("validation.email_incorrect"),x)},to:{required:v.withMessage(u("validation.required"),h),email:v.withMessage(u("validation.email_incorrect"),x)},subject:{required:v.withMessage(u("validation.required"),h)},body:{required:v.withMessage(u("validation.required"),h)}},t=Y(A,B(()=>r));function F(){b.value=!1}async function L(){let s=await M.fetchBasicMailConfig();r.id=c.id,s.data&&(r.from=s.data.from_mail),q.value&&(r.to=q.value.customer.email),r.body=M.selectedCompanySettings.invoice_mail_body}async function S(){if(t.value.$touch(),t.value.$invalid)return!0;try{if(i.value=!0,!b.value){const m=await k.previewInvoice(r);i.value=!1,b.value=!0;var s=new Blob([m.data],{type:"text/html"});C.value=URL.createObjectURL(s);return}if((await k.sendInvoice(r)).data.success)return y(),!0}catch(o){console.error(o),i.value=!1,P.showNotification({type:"error",message:u("invoices.something_went_wrong")})}}function y(){c.closeModal(),setTimeout(()=>{t.value.$reset(),b.value=!1,C.value=null},300)}return(s,o)=>{const m=d("BaseIcon"),V=d("BaseInput"),w=d("BaseInputGroup"),R=d("BaseCustomInput"),T=d("BaseInputGrid"),g=d("BaseButton"),E=d("BaseModal");return _(),j(E,{show:e(D),onClose:y,onOpen:L},{header:l(()=>[p("div",ee,[f($(e(G))+" ",1),a(m,{name:"XIcon",class:"w-6 h-6 text-gray-500 cursor-pointer",onClick:y})])]),default:l(()=>[b.value?(_(),N("div",re,[p("div",se,[a(g,{class:"absolute top-4 right-4",disabled:e(i),variant:"primary-outline",onClick:F},{default:l(()=>[a(m,{name:"PencilIcon",class:"h-5 mr-2"}),ne]),_:1},8,["disabled"]),p("iframe",{src:C.value,frameborder:"0",class:"w-full",style:{"min-height":"500px"}},null,8,le)]),p("div",ie,[a(g,{class:"mr-3",variant:"primary-outline",type:"button",onClick:y},{default:l(()=>[f($(s.$t("general.cancel")),1)]),_:1}),a(g,{loading:e(i),disabled:e(i),variant:"primary",type:"button",onClick:o[7]||(o[7]=n=>S())},{default:l(()=>[e(i)?U("",!0):(_(),j(m,{key:0,name:"PaperAirplaneIcon",class:"h-5 mr-2"})),f(" "+$(s.$t("general.send")),1)]),_:1},8,["loading","disabled"])])])):(_(),N("form",oe,[p("div",te,[a(T,{layout:"one-column",class:"col-span-7"},{default:l(()=>[a(w,{label:s.$t("general.from"),required:"",error:e(t).from.$error&&e(t).from.$errors[0].$message},{default:l(()=>[a(V,{modelValue:e(r).from,"onUpdate:modelValue":o[0]||(o[0]=n=>e(r).from=n),type:"text",invalid:e(t).from.$error,onInput:o[1]||(o[1]=n=>e(t).from.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),a(w,{label:s.$t("general.to"),required:"",error:e(t).to.$error&&e(t).to.$errors[0].$message},{default:l(()=>[a(V,{modelValue:e(r).to,"onUpdate:modelValue":o[2]||(o[2]=n=>e(r).to=n),type:"text",invalid:e(t).to.$error,onInput:o[3]||(o[3]=n=>e(t).to.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),a(w,{error:e(t).subject.$error&&e(t).subject.$errors[0].$message,label:s.$t("general.subject"),required:""},{default:l(()=>[a(V,{modelValue:e(r).subject,"onUpdate:modelValue":o[4]||(o[4]=n=>e(r).subject=n),type:"text",invalid:e(t).subject.$error,onInput:o[5]||(o[5]=n=>e(t).subject.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["error","label"]),a(w,{label:s.$t("general.body"),error:e(t).body.$error&&e(t).body.$errors[0].$message,required:""},{default:l(()=>[a(R,{modelValue:e(r).body,"onUpdate:modelValue":o[6]||(o[6]=n=>e(r).body=n),fields:z.value},null,8,["modelValue","fields"])]),_:1},8,["label","error"])]),_:1})]),p("div",ae,[a(g,{class:"mr-3",variant:"primary-outline",type:"button",onClick:y},{default:l(()=>[f($(s.$t("general.cancel")),1)]),_:1}),a(g,{loading:e(i),disabled:e(i),variant:"primary",type:"button",class:"mr-3",onClick:S},{left:l(n=>[e(i)?U("",!0):(_(),j(m,{key:0,class:Z(n.class),name:"PhotographIcon"},null,8,["class"]))]),default:l(()=>[f(" "+$(s.$t("general.preview")),1)]),_:1},8,["loading","disabled"])])]))]),_:1},8,["show"])}}};export{me as _};
